{% extends "base.html" %}
{% load static wagtailimages_tags %}

{% block title %}{{ page_title }} - pyOpenSci{% endblock %}

{% block content %}
<!-- Hero Section with Header Image -->
<section class="relative text-white overflow-hidden" style="background-image: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), url('{% static "images/headers/pyopensci-learn-header.png" %}'); background-size: cover; background-position: center;">
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        <div class="text-center">
            <h1 class="text-4xl font-bold mb-6">{{ hero_title }}</h1>
            <p class="text-xl opacity-90 max-w-3xl mx-auto">
                {{ hero_subtitle }}
            </p>
        </div>
    </div>
</section>

<!-- Intro Text -->
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12 text-center">
    <p class="text-lg text-gray-700">
        pyOpenSci runs free and paid training events that teach skills that scientists need
        to make their science more open and collaborative.
    </p>
</div>

<!-- Upcoming Events Section -->
{% if upcoming_events %}
<div class="py-16">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-3xl font-bold text-gray-900 mb-12 text-center">Upcoming Events</h2>

        <div class="flex flex-col gap-8">
            {% for event in upcoming_events %}
            <article class="flex border-2 border-gray-300 rounded-lg overflow-hidden hover:shadow-xl transition-shadow duration-300 min-h-[240px]">
                <a href="/events/{{ event.slug }}/" class="flex w-full">
                    <!-- Date Section (Purple sidebar - 1/3 width) -->
                    {% if event.header_image %}
                    <div class="relative w-1/3 flex items-center justify-center p-8 bg-cover bg-center" style="background: linear-gradient(rgba(51, 32, 92, 0.90), rgba(51, 32, 92, 0.90)), url('{{ event.header_image.url }}'); background-size: cover; background-position: center;">
                    {% else %}
                    <div class="relative w-1/3 flex items-center justify-center p-8" style="background-color: #33205c;">
                    {% endif %}
                        <!-- Date text -->
                        <div class="relative z-10 text-center text-white font-bold">
                            <span class="block text-5xl leading-none">{{ event.start_date|date:"d" }}</span>
                            {% if event.end_date and event.end_date != event.start_date %}
                            <span class="block text-5xl leading-none">-{{ event.end_date|date:"d" }}</span>
                            {% endif %}
                            <span class="block text-2xl mt-3">{{ event.start_date|date:"M" }}</span>
                            <span class="block text-base uppercase mt-1 tracking-wide">{{ event.start_date|date:"Y" }}</span>
                        </div>
                    </div>

                    <!-- Event Details (White section) -->
                    <div class="flex-1 p-8 bg-white flex flex-col justify-center">
                        <h3 class="text-3xl font-bold text-gray-900 mb-4 hover:text-pyos-deep-purple transition-colors">
                            {{ event.title }}
                        </h3>

                        {% if event.excerpt %}
                        <p class="text-lg text-gray-700 mb-6 line-clamp-3">{{ event.excerpt }}</p>
                        {% endif %}

                        <span class="inline-flex items-center text-lg text-pyos-deep-purple font-semibold hover:text-pyos-dark-purple">
                            Learn More <i class="fas fa-arrow-right ml-2"></i>
                        </span>
                    </div>
                </a>
            </article>
            {% endfor %}
        </div>
    </div>
</div>
{% else %}
<div class="py-8">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-3xl font-bold text-gray-900 mb-4">Upcoming Events</h2>
        <p class="text-gray-600">pyOpenSci doesn't have any events coming up right now. However, check back to see what we are planning!</p>
    </div>
</div>
{% endif %}

<!-- Past Events Section -->
<div id="past-events" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <!-- Section Header -->
    <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-gray-900 mb-4">Past Events</h2>
        <p class="text-gray-600 mb-4">Browse our complete event archive</p>

        <!-- Year filter dropdown -->
        {% if available_years %}
        <div class="flex justify-center items-center gap-4 mb-8">
            <label for="year-filter-events" class="text-sm font-medium text-gray-700">Filter by year:</label>
            <div class="relative inline-block">
                <select id="year-filter-events"
                        onchange="window.location.href=this.value"
                        class="appearance-none bg-white border-2 border-pyos-deep-purple rounded-lg px-4 py-2 pr-12 font-medium text-pyos-deep-purple hover:bg-pyos-light-purple focus:outline-none focus:ring-2 focus:ring-pyos-deep-purple focus:border-pyos-deep-purple transition-all cursor-pointer shadow-sm">
                    <option value="{% url 'core:events_index' %}#past-events" {% if not selected_year %}selected{% endif %}>All Years</option>
                    {% for year in available_years %}
                    <option value="{% url 'core:events_index' %}?year={{ year.year }}#past-events"
                            {% if selected_year == year.year|stringformat:'s' %}selected{% endif %}>
                        {{ year.year }}
                    </option>
                    {% endfor %}
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-pyos-deep-purple">
                    <svg class="w-4 h-4 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                        <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                    </svg>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    {% if events %}
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        {% for event in events %}
        <article class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 overflow-hidden">
            <!-- Event Image -->
            {% if event.header_image %}
            <div class="h-48 bg-gray-200">
                <img src="{{ event.header_image.url }}" alt="{{ event.header_image_alt|default:event.title }}" class="w-full h-full object-cover">
            </div>
            {% endif %}

            <!-- Event Content -->
            <div class="p-6">
                <!-- Event Type Badge -->
                <div class="flex justify-between items-start mb-3">
                    <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium uppercase">
                        {{ event.get_event_type_display }}
                    </span>
                    {% if event.start_date >= today %}
                    <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">Upcoming</span>
                    {% else %}
                    <span class="px-2 py-1 bg-gray-100 text-gray-600 rounded text-xs">Past</span>
                    {% endif %}
                </div>

                <!-- Title -->
                <h2 class="text-xl font-semibold text-gray-900 mb-3">
                    <a href="/events/{{ event.slug }}/" class="hover:text-blue-600 transition-colors">
                        {{ event.title }}
                    </a>
                </h2>

                <!-- Event Details -->
                <div class="space-y-2 text-sm text-gray-600 mb-4">
                    <div class="flex items-center">
                        <i class="far fa-calendar-alt mr-2"></i>
                        {{ event.start_date|date:"F j, Y" }}
                        {% if event.end_date and event.end_date != event.start_date %}
                        - {{ event.end_date|date:"F j, Y" }}
                        {% endif %}
                    </div>
                    {% if event.location %}
                    <div class="flex items-center">
                        <i class="fas fa-map-marker-alt mr-2"></i>
                        {{ event.location }}
                    </div>
                    {% endif %}
                </div>

                <!-- Excerpt -->
                {% if event.excerpt %}
                <p class="text-gray-600 mb-4">{{ event.excerpt|truncatewords:15 }}</p>
                {% endif %}

                <!-- Tags -->
                {% if event.tags.all %}
                <div class="flex flex-wrap gap-1 mb-4">
                    {% for tag in event.tags.all|slice:":3" %}
                    <span class="px-2 py-1 bg-gray-100 text-gray-600 rounded text-xs">
                        {{ tag.name }}
                    </span>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- Learn More -->
                <a href="/events/{{ event.slug }}/" class="text-blue-600 hover:text-blue-800 font-medium text-sm">
                    Learn more â†’
                </a>
            </div>
        </article>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if events.has_other_pages %}
    <div class="flex justify-center mt-12">
        <nav class="flex items-center gap-2">
            {% if events.has_previous %}
            <a href="?page={{ events.previous_page_number }}{% if selected_year %}&year={{ selected_year }}{% endif %}#past-events"
               class="px-4 py-2 rounded-lg bg-gray-300 text-gray-800 hover:bg-gray-400 transition-colors">
                <i class="fas fa-chevron-left"></i> Previous
            </a>
            {% else %}
            <span class="px-4 py-2 rounded-lg bg-gray-200 text-gray-400 cursor-not-allowed">
                <i class="fas fa-chevron-left"></i> Previous
            </span>
            {% endif %}

            {% for num in events.paginator.page_range %}
                {% if events.number == num %}
                    <span class="px-4 py-2 rounded-lg bg-pyos-deep-purple text-white font-medium">{{ num }}</span>
                {% elif num > events.number|add:'-3' and num < events.number|add:'3' %}
                    <a href="?page={{ num }}{% if selected_year %}&year={{ selected_year }}{% endif %}#past-events"
                       class="px-4 py-2 rounded-lg bg-gray-300 text-gray-800 hover:bg-gray-400 transition-colors">
                        {{ num }}
                    </a>
                {% endif %}
            {% endfor %}

            {% if events.has_next %}
            <a href="?page={{ events.next_page_number }}{% if selected_year %}&year={{ selected_year }}{% endif %}#past-events"
               class="px-4 py-2 rounded-lg bg-gray-300 text-gray-800 hover:bg-gray-400 transition-colors">
                Next <i class="fas fa-chevron-right"></i>
            </a>
            {% else %}
            <span class="px-4 py-2 rounded-lg bg-gray-200 text-gray-400 cursor-not-allowed">
                Next <i class="fas fa-chevron-right"></i>
            </span>
            {% endif %}
        </nav>
    </div>
    {% endif %}

    {% else %}
    <!-- Empty State -->
    <div class="text-center py-16">
        <div class="max-w-md mx-auto">
            <i class="fas fa-calendar-alt text-6xl text-gray-300 mb-4"></i>
            <h2 class="text-2xl font-semibold text-gray-900 mb-2">No events scheduled</h2>
            <p class="text-gray-600">Check back soon for upcoming workshops, webinars, and community events.</p>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}