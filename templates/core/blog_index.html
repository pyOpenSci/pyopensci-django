{% extends "base.html" %}
{% load static wagtailimages_tags %}

{% block title %}{{ page_title }} - pyOpenSci{% endblock %}

{% block content %}
<!-- Hero Section with Header Image -->
<section class="relative text-white overflow-hidden" style="background-image: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), url('{% static "images/headers/pyopensci-learn-header.png" %}'); background-size: cover; background-position: center;">
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        <div class="text-center">
            <h1 class="text-4xl font-bold mb-6">{{ hero_title }}</h1>
            <p class="text-xl opacity-90 max-w-3xl mx-auto">
                {{ hero_subtitle }}
            </p>
        </div>
    </div>
</section>

<!-- Blog Posts -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <!-- Section Header -->
    <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-gray-900 mb-4">Recent pyOpenSci blog posts</h2>
        <!-- Year filter dropdown -->
        {% if available_years %}
        <div class="flex justify-center items-center gap-4 mb-8">
            <label for="year-filter" class="text-sm font-medium text-gray-700">Filter by year:</label>
            <div class="relative inline-block">
                <select id="year-filter"
                        onchange="window.location.href=this.value"
                        class="appearance-none bg-white border-2 border-pyos-deep-purple rounded-lg px-4 py-2 pr-12 font-medium text-pyos-deep-purple hover:bg-pyos-light-purple focus:outline-none focus:ring-2 focus:ring-pyos-deep-purple focus:border-pyos-deep-purple transition-all cursor-pointer shadow-sm">
                    <option value="{% url 'core:blog_index' %}" {% if not selected_year %}selected{% endif %}>All Years</option>
                    {% for year in available_years %}
                    <option value="{% url 'core:blog_index' %}?year={{ year.year }}"
                            {% if selected_year == year.year|stringformat:'s' %}selected{% endif %}>
                        {{ year.year }}
                    </option>
                    {% endfor %}
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-pyos-deep-purple">
                    <svg class="w-4 h-4 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                        <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                    </svg>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    {% if blog_posts %}
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        {% for post in blog_posts %}
        <article class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 overflow-hidden">
            <!-- Post Image -->
            {% if post.header_image %}
            <div class="h-48 bg-gray-200">
                <img src="{{ post.header_image.url }}" alt="{{ post.header_image_alt|default:post.title }}" class="w-full h-full object-cover">
            </div>
            {% endif %}

            <!-- Post Content -->
            <div class="p-6">
                <!-- Meta -->
                <div class="flex items-center text-sm text-gray-500 mb-3">
                    <time>{{ post.date|date:"M j, Y" }}</time>
                    {% if post.author %}
                    <span class="mx-2">•</span>
                    <span>{{ post.author.name }}</span>
                    {% endif %}
                </div>

                <!-- Title -->
                <h2 class="text-xl font-semibold text-gray-900 mb-3">
                    <a href="/blog/{{ post.slug }}/" class="hover:text-blue-600 transition-colors">
                        {{ post.title }}
                    </a>
                </h2>

                <!-- Excerpt -->
                {% if post.excerpt %}
                <p class="text-gray-600 mb-4">{{ post.excerpt|truncatewords:20 }}</p>
                {% endif %}

                <!-- Tags -->
                {% if post.tags.all %}
                <div class="flex flex-wrap gap-1 mb-4">
                    {% for tag in post.tags.all|slice:":3" %}
                    <span class="px-2 py-1 bg-gray-100 text-gray-600 rounded text-xs">
                        {{ tag.name }}
                    </span>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- Read More -->
                <a href="/blog/{{ post.slug }}/" class="text-blue-600 hover:text-blue-800 font-medium text-sm">
                    Read more →
                </a>
            </div>
        </article>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if blog_posts.has_other_pages %}
    <div class="flex justify-center mt-12">
        <nav class="flex items-center gap-2">
            {% if blog_posts.has_previous %}
            <a href="?page={{ blog_posts.previous_page_number }}{% if selected_year %}&year={{ selected_year }}{% endif %}"
               class="px-4 py-2 rounded-lg bg-gray-300 text-gray-800 hover:bg-gray-400 transition-colors">
                <i class="fas fa-chevron-left"></i> Previous
            </a>
            {% else %}
            <span class="px-4 py-2 rounded-lg bg-gray-200 text-gray-400 cursor-not-allowed">
                <i class="fas fa-chevron-left"></i> Previous
            </span>
            {% endif %}

            {% for num in blog_posts.paginator.page_range %}
                {% if blog_posts.number == num %}
                    <span class="px-4 py-2 rounded-lg bg-pyos-deep-purple text-white font-medium">{{ num }}</span>
                {% elif num > blog_posts.number|add:'-3' and num < blog_posts.number|add:'3' %}
                    <a href="?page={{ num }}{% if selected_year %}&year={{ selected_year }}{% endif %}"
                       class="px-4 py-2 rounded-lg bg-gray-300 text-gray-800 hover:bg-gray-400 transition-colors">
                        {{ num }}
                    </a>
                {% endif %}
            {% endfor %}

            {% if blog_posts.has_next %}
            <a href="?page={{ blog_posts.next_page_number }}{% if selected_year %}&year={{ selected_year }}{% endif %}"
               class="px-4 py-2 rounded-lg bg-gray-300 text-gray-800 hover:bg-gray-400 transition-colors">
                Next <i class="fas fa-chevron-right"></i>
            </a>
            {% else %}
            <span class="px-4 py-2 rounded-lg bg-gray-200 text-gray-400 cursor-not-allowed">
                Next <i class="fas fa-chevron-right"></i>
            </span>
            {% endif %}
        </nav>
    </div>
    {% endif %}

    {% else %}
    <!-- Empty State -->
    <div class="text-center py-16">
        <div class="max-w-md mx-auto">
            <i class="fas fa-blog text-6xl text-gray-300 mb-4"></i>
            <h2 class="text-2xl font-semibold text-gray-900 mb-2">No blog posts yet</h2>
            <p class="text-gray-600">Check back soon for the latest updates and insights from the pyOpenSci community.</p>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}